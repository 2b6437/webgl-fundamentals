<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ja/webgl-boilerplate.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Gregg Tavares. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta property="og:title" content="WebGLのひな型コード" />
<meta property="og:type" content="website" />
<meta property="og:image" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />
<meta property="og:description" content="全てのWebGLで共通して必要となるコード" />
<meta property="og:url" content="http://webglfundamentals.org/webgl/lessons/ja/webgl-boilerplate.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="webglfundamentals.org" />
<meta name="twitter:title" content="WebGLのひな型コード" />
<meta name="twitter:url" content="http://webglfundamentals.org/webgl/lessons/ja/webgl-boilerplate.html" />
<meta name="twitter:description" content="全てのWebGLで共通して必要となるコード" />
<meta name="twitter:image:src" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />


<title>WebGLのひな型コード</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css" type="text/css" />
</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-boilerplate.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-boilerplate.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-boilerplate.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-boilerplate.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-boilerplate.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-boilerplate.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-boilerplate.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-boilerplate.html" >简体中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ja/">WebGLFundamentals.org</a></h1>
</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGLのひな型コード</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>この記事は「<a href="webgl-fundamentals.html">WebGLの基本</a>」の続きです。</p>
<p>WebGLの説明は複雑になり勝ちです。ひとつの話の中に
さまざまな要素が一度に含まれることが多いためです。
私はこれを可能な限り避け、話題を細かく分けています。</p>
<h2 id="-">「シェーダーのコンパイル、リンク処理」のひな形コード</h2>
<p>WebGLを難しく感じさせている要素のひとつは、
「頂点シェーダー」、「フラグメントシェーダー｣と呼ばれる二つの小さな関数です。
これらの関数は「CPU」ではなく「GPU」という場所で実行されます。
GPUは、WebGLのスピードのかなめとなるものです。
GPUの特性を活かすため、これらの関数はGPU専用の言語で記述する必要があります。</p>
<p>これらの関数をコンパイル、リンクするという手順は必ず行います。
また、そのためのコードはほとんどのWebGLアプリケーションで共通です。</p>
<p>これは、「シェーダーをコンパイルする」ためのコードのひな型(Boilerplate code)です。</p>
<pre class="prettyprint"><code>/**
 * シェーダーを生成、コンパイルする。
 *
 * @param {!WebGLRenderingContext} gl WebGLコンテキスト。
 * @param {string} shaderSource シェーダーのGLSLソースコード。
 * @param {number} shaderType シェーダーの種類。VERTEX_SHADERまたは
 *     FRAGMENT_SHADER。
 * @return {!WebGLShader} シェーダー。
 */
function compileShader(gl, shaderSource, shaderType) {
  // シェーダーのオブジェクトを生成する。
  var shader = gl.createShader(shaderType);

  // シェーダーのソースコードをセットする。
  gl.shaderSource(shader, shaderSource);

  // シェーダーをコンパイルする。
  gl.compileShader(shader);

  // コンパイルが成功したか確認する。
  var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
  if (!success) {
    // コンパイル中に問題があった場合、エラーを取得する。
    throw &quot;could not compile shader:&quot; + gl.getShaderInfoLog(shader);
  }

  return shader;
}
</code></pre><p>そしてこれは「2つのシェーダーをプログラムにリンクする」コードのひな型です。</p>
<pre class="prettyprint"><code>/**
 * 2つのシェーダーからプログラムを生成する。
 *
 * @param {!WebGLRenderingContext) gl WebGLコンテキスト。
 * @param {!WebGLShader} vertexShader 頂点シェーダー。
 * @param {!WebGLShader} fragmentShader フラグメントシェーダー。
 * @return {!WebGLProgram} WebGLプログラム。
 */
function createProgram(gl, vertexShader, fragmentShader) {
  // プログラムを生成する。
  var program = gl.createProgram();

  // シェーダーをアタッチする。
  gl.attachShader(program, vertexShader);
  gl.attachShader(program, fragmentShader);

  // プログラムをリンクする。
  gl.linkProgram(program);

  // リンクが成功したか確認する。
  var success = gl.getProgramParameter(program, gl.LINK_STATUS);
  if (!success) {
      // リンク中に問題があった場合、エラーを取得する。
      throw (&quot;program filed to link:&quot; + gl.getProgramInfoLog (program));
  }

  return program;
};
</code></pre><p>「共通のコード」とはいえ、
もちろん「エラー発生時にどう処理するか」といった部分は、あなた次第です。
「例外をスローする」のが最適なエラーハンドリングでないこともあります。
しかし、ここに挙げた短いコードは、「ほとんど全てのWebGLプログラムで共通」です。</p>
<p>私は、シェーダーのコードを&lt;script&gt;タグを使って書く方法を好んで使っています。
この方法を使う場合、以下のようなコードで処理することになります。</p>
<pre class="prettyprint"><code>/**
 * script要素に書かれた内容からシェーダーを生成する。
 *
 * @param {!WebGLRenderingContext} gl WebGLコンテキスト。
 * @param {string} scriptId scriptタグのid。
 * @param {string} opt_shaderType 生成するシェーダーの種類。
 *     省略した場合はscriptタグのtypeプロパティを使う。
 * @return {!WebGLShader} シェーダー。
 */
function createShaderFromScript(gl, scriptId, opt_shaderType) {
  // scriptタグをidを使って参照する。
  var shaderScript = document.getElementById(scriptId);
  if (!shaderScript) {
    throw(&quot;*** Error: unknown script element&quot; + scriptId);
  }

  // script要素内のテキストを取り出す。
  var shaderSource = shaderScript.text;

  // 引数でシェーダーの種類を指定しなかった場合は、
  // scriptタグのtypeプロパティを使う。
  if (!opt_shaderType) {
    if (shaderScript.type == &quot;x-shader/x-vertex&quot;) {
      opt_shaderType = gl.VERTEX_SHADER;
    } else if (shaderScript.type == &quot;x-shader/x-fragment&quot;) {
      opt_shaderType = gl.FRAGMENT_SHADER;
    } else if (!opt_shaderType) {
      throw(&quot;*** Error: shader type not set&quot;);
    }
  }

  return compileShader(gl, shaderSource, opt_shaderType);
};
</code></pre><p>以下のコードでシェーダーをコンパイルできます。</p>
<pre class="prettyprint"><code>var shader = createShaderFromScript(gl, &quot;someScriptTagId&quot;);
</code></pre><p>私がよく使うのは、さらに一歩踏み込んで「二つのシェーダーをそれぞれの書かれた
script要素から読み込んでコンパイルし、プログラムにアタッチ、リンクまで行う関数」です。</p>
<pre class="prettyprint"><code>/**
 * 二つのscript要素を使ってWebGLProgramを生成する。
 *
 * @param {!WebGLRenderingContext} gl WebGLコンテキスト。
 * @param {string[]} shaderScriptIds script要素のidプロパティの配列。
 *        一つ目を頂点シェーダー、二つ目をフラグメントシェーダーとみなす。
 * @return {!WebGLProgram} WebGLプログラム。
 */
function createProgramFromScripts(
    gl, shaderScriptIds) {
  var vertexShader = createShaderFromScript(gl, shaderScriptIds[0], gl.VERTEX_SHADER);
  var fragmentShader = createShaderFromScript(gl, shaderScriptIds[1], gl.FRAGMENT_SHADER);
  return createProgram(gl, vertexShader, fragmentShader);
}
</code></pre><h2 id="-canvas-">「canvasのリサイズ処理」のひな形コード</h2>
<p>もうひとつ、私がほとんどのWebGLプログラムで使っているのは、
「canvasのリサイズ処理」をするコードです。
このコードの実装内容については<a href="webgl-resizing-the-canvas.html">このドキュメント</a>
で紹介しています。</p>
<h2 id="-">ひな形コードの利用</h2>
<p>以上、２つのひな形コードは<code>webgl-utils.js</code>として一つにまとめてあります。
これを利用するには、</p>
<pre class="prettyprint"><code>&lt;script src=&quot;resources/webgl-utils.js&quot;&gt;&lt;/script&gt;
</code></pre><p>といったコードで取り込んだ上で、以下のようなコードで呼び出します。</p>
<pre class="prettyprint"><code>var program = webglUtils.createProgramFromScripts(
  gl, [idOfVertexShaderScript, idOfFragmentShaderScript]);

...

webglUtils.resizeCanvasToMatchDisplaySize(canvas);
</code></pre><h2 id="-">まとめ</h2>
<p>まったく同じ大量のコードが全てのサンプルに含まれているために
「そのサンプルが何のために書かれたサンプルなのか判りにくく
なってしまう」のは本末転倒で、避けるべきであるとと思います。</p>
<p>以上で、私の「最小のWebGLひな型コード(boilerplate code)」のおおまかな紹介を終わります。
<a href="../../resources/webgl-utils.js"><code>webgl-utils.js</code>のコードはここにあります</a>。</p>
<p>さらにしっかり構成されたライブラリに興味があるようでしたら<a href="http://twgljs.org">TWGL.js</a>
をチェックしてください。</p>
<p>WebGLを複雑に見せているもう一つの要素は「シェーダーにデータを渡す手順」です。
そのあたりの話題については「<a href="webgl-how-it-works.html">WebGLの仕組み</a>」
で紹介しています。
これについては、「<a href="webgl-less-code-more-fun.html">少ないコード、大きな喜び</a>」や、
<a href="http://twgljs.org">TWGL</a>も参考になるはずです。</p>
<p>以上のほかにも、同様の理由で作られたスクリプトがあるので紹介しておきます。</p>
<ul>
<li><p><a href="../../resources/webgl-lessons-ui.js"><code>webgl-lessons-ui.js</code></a></p>
<p>このスクリプトは、スライダを使って数値をセットしたり視覚化したりするためのものです。
講義の中でよく使う機能なのでこのファイルにまとめました。</p>
</li>
<li><p><a href="../../resources/lessons-helper.js"><code>lessons-helper.js</code></a></p>
<p>このスクリプトは、webglfundmentals.org以外では必要ないでしょう。
ほかのものに埋め込まれたlive editor上で使うと、エラーメッセージを
画面に表示することができます。</p>
</li>
<li><p><a href="../../resources/m3.js"><code>m3.js</code></a></p>
<p>このスクリプトには、二次元を扱う計算関連の関数が多数定義されています。
これらの関数は、このサイトの行列計算の最初の講義で作り始め、いくつかの章の中で
追加していったものです。
より応用的な話題を扱う章では、同じものを一から書くのは話が複雑になるだけなので
このスクリプトにまとめて使っています。</p>
</li>
<li><p><a href="../../resources/m4.js"><code>m4.js</code></a></p>
<p>このスクリプトには、三次元を扱う計算関連の関数が多数定義されています。
これらの関数は、このサイトの３Ｄ関連の講義の中で作ったものです。
３Ｄ関連の２番目の記事からは、このスクリプトを利用しています。</p>
</li>
</ul>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-boilerplate.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-boilerplate.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-boilerplate.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-boilerplate.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-boilerplate.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-boilerplate.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-boilerplate.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-boilerplate.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-fundamentals.html">WebGLの基本</a></li>
<li><a href="/webgl/lessons/ja/webgl-how-it-works.html">WebGLの仕組み</a></li>
<li><a href="/webgl/lessons/ja/webgl-shaders-and-glsl.html">WebGLのシェーダーとGLSL</a></li>
        </ul>
  <li>画像処理</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-image-processing.html">WebGLにおける画像処理</a></li>
<li><a href="/webgl/lessons/ja/webgl-image-processing-continued.html">WebGLにおける画像処理。続き</a></li>
        </ul>
  <li>2Dでの移動、回転、拡大縮小、行列計算</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-translation.html">WebGL - 二次元での移動</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-rotation.html">WebGL - 二次元での回転</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-scale.html">WebGL - 二次元での拡大縮小</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrices.html">WebGL - 二次元での行列数学</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-orthographic.html">WebGL三次元の正投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective.html">WebGL三次元透視投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-camera.html">WebGL三次元のカメラ</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-lighting-directional.html">WebGL三次元指向性光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-point.html">WebGL三次元点光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-spot.html">WebGL 3D - Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-less-code-more-fun.html">WebGL - Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-multiple-things.html">WebGL - Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/ja/webgl-scene-graph.html">WebGL - Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-geometry-lathe.html">WebGL 3D Geometry - Lathe</a></li>
        </ul>
  <li>テクスチャ</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-textures.html">WebGL 3D - Textures</a></li>
<li><a href="/webgl/lessons/ja/webgl-data-textures.html">WebGLのデータテクスチャ</a></li>
<li><a href="/webgl/lessons/ja/webgl-2-textures.html">WebGLで複数のテクスチャを使う</a></li>
<li><a href="/webgl/lessons/ja/webgl-cors-permission.html">WebGL - Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html">WebGL 3D - Perspective Correct Texture Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-render-to-texture.html">WebGL Render to Texture</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-drawimage.html">WebGL 2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrix-stack.html">WebGL 2D - Matrix Stack</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-cube-maps.html">WebGL - Cubemaps</a></li>
<li><a href="/webgl/lessons/ja/webgl-environment-maps.html">WebGL - Environment maps</a></li>
<li><a href="/webgl/lessons/ja/webgl-skybox.html">WebGL - Skyboxes</a></li>
<li><a href="/webgl/lessons/ja/webgl-skinning.html">WebGL - Skinning</a></li>
<li><a href="/webgl/lessons/ja/webgl-fog.html">WebGL - Fog</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-text-html.html">WebGL Text - HTML</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-canvas2d.html">WebGL Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-texture.html">WebGL Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-glyphs.html">WebGL Text - Using a Glyph Texture</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-smallest-programs.html">WebGL Smallest Programs</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-without-data.html">WebGL Drawing Without Data</a></li>
<li><a href="/webgl/lessons/ja/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>その他のトピック</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-setup-and-installation.html">WebGLの開発環境</a></li>
<li><a href="/webgl/lessons/ja/webgl-boilerplate.html">WebGLのひな型コード</a></li>
<li><a href="/webgl/lessons/ja/webgl-resizing-the-canvas.html">WebGLとcanvasのリサイズ</a></li>
<li><a href="/webgl/lessons/ja/webgl-animation.html">WebGLのアニメーション</a></li>
<li><a href="/webgl/lessons/ja/webgl-and-alpha.html">WebGL and Alpha</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-vs-3d-library.html">WebGL - 2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/ja/webgl-anti-patterns.html">WebGL - Anti-Patterns</a></li>
<li><a href="/webgl/lessons/ja/webgl-matrix-vs-math.html">WebGL Matrices vs Math Matrices</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-attributes.html">WebGL Attributes</a></li>
<li><a href="/webgl/lessons/ja/webgl-texture-units.html">WebGL Texture Units</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs(英語)</a></li>
  <li><a href="http://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>質問? <a href="http://stackoverflow.com/questions/tagged/webgl">stackoverflowで質問(英語)</a>.</div>
        <div>問題点/バグ? <a href="http://github.com/gfxfundamentals/webgl-fundamentals/issues">githubでissueを作成</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGLのひな型コード';
            var disqus_title = 'WebGLのひな型コード';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js"></script>
<script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');

</script>


</html>



