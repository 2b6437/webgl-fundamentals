<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ja/webgl-data-textures.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Gregg Tavares. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta property="og:title" content="WebGLのデータテクスチャ" />
<meta property="og:type" content="website" />
<meta property="og:image" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />
<meta property="og:description" content="テクスチャーを配列データから生成する" />
<meta property="og:url" content="http://webglfundamentals.org/webgl/lessons/ja/webgl-data-textures.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="webglfundamentals.org" />
<meta name="twitter:title" content="WebGLのデータテクスチャ" />
<meta name="twitter:url" content="http://webglfundamentals.org/webgl/lessons/ja/webgl-data-textures.html" />
<meta name="twitter:description" content="テクスチャーを配列データから生成する" />
<meta name="twitter:image:src" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />


<title>WebGLのデータテクスチャ</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css" type="text/css" />
</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-data-textures.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-data-textures.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-data-textures.html" selected>日本語</a>
    <option value="/webgl/lessons/pl/webgl-data-textures.html" >Polski</a>
    <option value="/webgl/lessons/ru/webgl-data-textures.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-data-textures.html" >简体中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ja/">WebGLFundamentals.org</a></h1>
</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGLのデータテクスチャ</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>この記事はWebGLの連載シリーズのひとつである。
連載は「<a href="webgl-fundamentals.html">WebGLの基本</a>」から始まり、
前回は<a href="webgl-3d-textures.html">テクスチャー</a>について説明した。</p>
<p>前回の講義では、WebGLにおける「テクスチャーの仕組みと使い方」について説明した。
その際、テクスチャーはダウンロードした画像から生成した。
今回の講義では画像ではなく「JavaScriptから直接テクスチャーデータを生成する方法」を
説明しようと思う。</p>
<p>JavaScriptでテクスチャーのデータを生成する方法は、とても直接的である。
テクスチャで利用できるデータ型は以下の通りである。
このリストは、「WebGL1がデフォルトでサポートしているもの」に限定している。</p>
<p><style>
.local-data {
  font-family: monospace;
  font-size: large;
  text-align: left;
  display: inline-block;
}
.local-data thead {
  background: lightblue;
}
.local-data td {
  border: 1px solid black;
  padding: 0.2em;
}
.local-data td:nth-child(3),
.local-data td:nth-child(4) {
  text-align: center;
}
</style></p>
<div class="webgl_center">
  <table class="local-data">
    <thead>
      <tr><td>フォーマット</td><td>データ型</td><td>チャンネル数</td><td>ピクセルあたりのバイト数</td></tr>
    </thead>
    <tbody>
      <tr><td>RGBA</td><td>UNSIGNED_BYTE</td><td>4</td><td>4</td></tr>
      <tr><td>RGB</td><td>UNSIGNED_BYTE</td><td>3</td><td>3</td></tr>
      <tr><td>RGBA</td><td>UNSIGNED_SHORT_4_4_4_4</td><td>4</td><td>2</td></tr>
      <tr><td>RGBA</td><td>UNSIGNED_SHORT_5_5_5_1</td><td>4</td><td>2</td></tr>
      <tr><td>RGB</td><td>UNSIGNED_SHORT_5_6_5</td><td>3</td><td>2</td></tr>
      <tr><td>LUMINANCE_ALPHA</td><td>UNSIGNED_BYTE</td><td>2</td><td>2</td></tr>
      <tr><td>LUMINANCE</td><td>UNSIGNED_BYTE</td><td>1</td><td>1</td></tr>
      <tr><td>ALPHA</td><td>UNSIGNED_BYTE</td><td>1</td><td>1</td></tr>
    </tbody>
  </table>
</div>

<p>早速だが、「3x2ピクセルの<code>LUMINANCE</code>型のテクスチャー」を生成してみよう。
<code>LUMINANCE</code>テクスチャーは、ピクセル1つにつき1つだけ値を持ち、
RGB全てのチャンネルでその値が使用される。&quot;luminance&quot;とは、英語で「明るさ」を表す。</p>
<p><a href="webgl-3d-textures.html">前回の講義</a>で使用したサンプルを流用しよう。
まず、立方体の各面で「テクスチャ全体を使う」ように、テクスチャ座標を変更する。</p>
<pre><code>// 立方体の各面について「テクスチャ座標」をバッファにセットする。
function setTexcoords(gl) {
  gl.bufferData(
      gl.ARRAY_BUFFER,
      new Float32Array([
        // 前面
        0, 0,
        0, 1,
        1, 0,
        1, 0,
        0, 1,
        1, 1,
        ...
</code></pre><p>テクスチャーを生成するコードを変更する。</p>
<pre><code>// テクスチャーを生成する。
var texture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, texture);

-// テクスチャーを「1x1の青いピクセル」で塗りつぶす。
-gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0, gl.RGBA, gl.UNSIGNED_BYTE,
-              new Uint8Array([0, 0, 255, 255]));

// テクスチャーを「3x2ピクセルのデータ」で塗りつぶす。
const level = 0;
const internalFormat = gl.LUMINANCE;
const width = 3;
const height = 2;
const border = 0;
const format = gl.LUMINANCE;
const type = gl.UNSIGNED_BYTE;
const data = new Uint8Array([
  128,  64, 128,
    0, 192,   0,
]);
gl.texImage2D(gl.TEXTURE_2D, level, internalFormat, width, height, border,
              format, type, data);

// MipMapは不要なのでフィルタリングはしないように設定する。
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);

-// 非同期での画像読み込みを行う
-...
</code></pre><p>実行結果はこのようになる。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-data-texture-3x2-bad.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-data-texture-3x2-bad.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>ええっ！？どうして動かないのだ？！？！？</p>
<p>JavaScriptコンソールを調べると、以下のようなエラーが出ていることがわかる。</p>
<pre><code>WebGL: INVALID_OPERATION: texImage2D: ArrayBufferView not big enough for request
</code></pre><p>メッセージの細かい内容は実行環境によって異なるが「読み出そうとしたがデータが足りない」
といった意味のエラーが出ているはずだ。</p>
<p>WebGLには曖昧な設定があるのだが、この問題はそれに由来している。
この問題は、WebGLの先祖であるOpenGLが誕生した時からそのままになっているものだ。</p>
<p>一般にコンピュータは、データが特定のサイズの時に最速で処理を行える。
例えば「データを2バイト、4バイト、8バイトずつまとめてコピーする場合は、
1バイトずつコピーする場合よりも速い」といった状況がある。
WebGLの場合は、デフォルトでは「<strong>1件あたり4バイト</strong>」としてデータを扱うことになっている。
WebGLはデータ全体が「4バイトの整数倍のサイズ」であると期待して処理を行う(最後の1件を除く)。</p>
<p>一方、我々が用意したデータは3x2、つまり「1件当たり3バイト」で「全部で6バイト」のデータである。
このためWebGLはまず「1件目の3バイトのデータ」を
「4バイトのデータ」として読み込む。
そして「2件目の3バイトのデータ」は「3バイトのデータ」として読み込んで、
「トータルで読み込んだ7バイト」を読み込んだ結果、
これが「4バイトの整数倍のサイズ」でないためエラーを出しているのである。</p>
<p>「<strong>1件あたり4バイト</strong>」ではなく「<strong>1件あたり1バイト</strong>」として処理させるには、
WebGLに以下のような設定を行なえばよい。</p>
<pre><code>const alignment = 1;
gl.pixelStorei(gl.UNPACK_ALIGNMENT, alignment);
</code></pre><p><code>alignment</code>の値には、<code>1</code>、<code>2</code>、<code>4</code>、<code>8</code>のいずれかが指定できる。
アラインメント(<code>alignment</code>)とは、英語で「位置あわせ」のような意味である。</p>
<p>私が観察した限り、alignmentの違いによる実行速度の差は
測定できるようなレベルでは全くない。
WebGLのこの仕様のデフォルトが4バイトではなく1バイトになっていたら
ずいぶん初心者に優しいのではないかとも思うが、
OpenGLとの互換性を保つ必要があるためこのようになっている。
ともあれ、このおかげで、WebGLに移植されたアプリケーションが
パディングのデフォルト値に依存していたとしても変更なしに動作する。
これは「デフォルト値」だけの問題なので、新たに最初からWebGL用に
アプリケーションを作る際は、
単純に「必ず明示的に<code>1</code>をセット」してしまえばよいだろう。</p>
<p>以上を踏まえてサンプルを書き直すと、このようになる。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-data-texture-3x2.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-data-texture-3x2.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>アラインメントの問題について確認できたので、
次回は「<a href="webgl-render-to-texture.html">テクスチャへの描画</a>」の話をしよう。</p>
<div class="webgl_bottombar">
<h3>ピクセルとテクセル</h3>
<p>テクスチャの文脈では、ピクセルのことを「テクセル」と呼ぶことがある。
pixelという単語は「picture element(画像要素)」に由来し、
texelという単語は「texture element(テクスチャ要素)」に由来する。
</p>
<p>CG業界のえらい人たちからご指摘を頂くこともあるが、控えめにいって
「テクセル」は「業界用語」の典型例である。個人的には、テクスチャ要素の文脈でも
特に意識せず「ピクセル」と表現することにしている。&#x1f607;
</p>
</div>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-data-textures.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-data-textures.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-data-textures.html" selected>日本語</a>
    <option value="/webgl/lessons/pl/webgl-data-textures.html" >Polski</a>
    <option value="/webgl/lessons/ru/webgl-data-textures.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-data-textures.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>
  <li>基本</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-fundamentals.html">WebGLの基本</a></li>
    <li><a href="/webgl/lessons/ja/webgl-how-it-works.html">WebGLの仕組み</a></li>
    <li><a href="/webgl/lessons/ja/webgl-shaders-and-glsl.html">WebGLのシェーダーとGLSL</a></li>
  </ul>
  <li>画像処理</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-image-processing.html">WebGLにおける画像処理</a></li>
    <li><a href="/webgl/lessons/ja/webgl-image-processing-continued.html">WebGLにおける画像処理。続き</a></li>
  </ul>
  <li>2Dでの移動、回転、拡大縮小、行列計算</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-2d-translation.html">WebGL - 二次元での移動</a></li>
    <li><a href="/webgl/lessons/ja/webgl-2d-rotation.html">WebGL - 二次元での回転</a></li>
    <li><a href="/webgl/lessons/ja/webgl-2d-scale.html">WebGL - 二次元での拡大縮小</a></li>
    <li><a href="/webgl/lessons/ja/webgl-2d-matrices.html">WebGL - 二次元での行列数学</a></li>
  </ul>
  <li>3D</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-3d-orthographic.html">WebGL三次元の正投影</a></li>
    <li><a href="/webgl/lessons/ja/webgl-3d-perspective.html">WebGL三次元透視投影</a></li>
    <li><a href="/webgl/lessons/ja/webgl-3d-camera.html">WebGL三次元のカメラ</a></li>
  </ul>
  <li>Lighting</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-3d-lighting-directional.html">WebGL三次元指向性光源</a></li>
    <li><a href="/webgl/lessons/ja/webgl-3d-lighting-point.html">WebGL三次元点光源</a></li>
    <li><a href="/webgl/lessons/ja/webgl-3d-lighting-spot.html">WebGL三次元スポットライト(英語)</a></li>
  </ul>
  <li>Structure and Organization</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-less-code-more-fun.html">WebGL - Less Code, More Fun(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-drawing-multiple-things.html">WebGL - Drawing Multiple Things(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-scene-graph.html">WebGL - Scene Graphs(英語)</a></li>
  </ul>
  <li>Geometry</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-3d-geometry-lathe.html">WebGL 3D Geometry - Lathe(英語)</a></li>
  </ul>
  <li>テクスチャ</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-3d-textures.html">WebGL 3D - Textures(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-data-textures.html">WebGLのデータテクスチャ</a></li>
    <li><a href="/webgl/lessons/ja/webgl-2-textures.html">WebGLで複数のテクスチャを使う</a></li>
    <li><a href="/webgl/lessons/ja/webgl-cors-permission.html">WebGL - Cross Origin Images(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html">WebGL 3D - Perspective Correct Texture Mapping(英語)</a></li>
  </ul>
  <li>Rendering To A Texture</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-render-to-texture.html">WebGL Render to Texture</a></li>
  </ul>
  <li>Techniques</li>
  <ul>
    <li>2D</li>
    <ul>
      <li><a href="/webgl/lessons/ja/webgl-2d-drawimage.html">WebGL 2D - DrawImage(英語)</a>
      <li><a href="/webgl/lessons/ja/webgl-2d-matrix-stack.html">WebGL 2D - Matrix Stack(英語)</a>
    </ul>
    <li>Text</li>
    <ul>
      <li><a href="/webgl/lessons/ja/webgl-text-html.html">WebGL Text - HTML(英語)</a>
      <li><a href="/webgl/lessons/ja/webgl-text-canvas2d.html">WebGL Text - Canvas 2D(英語)</a>
      <li><a href="/webgl/lessons/ja/webgl-text-texture.html">WebGL Text - Using a Texture(英語)</a>
      <li><a href="/webgl/lessons/ja/webgl-text-glyphs.html">WebGL Text - Using a Glyph Texture(英語)</a>
    </ul>
  </ul>
  <li>その他のトピック</li>
  <ul>
    <li><a href="/webgl/lessons/ja/webgl-setup-and-installation.html">WebGLの開発環境</a></li>
    <li><a href="/webgl/lessons/ja/webgl-boilerplate.html">WebGLのひな型コード</a></li>
    <li><a href="/webgl/lessons/ja/webgl-resizing-the-canvas.html">WebGLとcanvasのリサイズ</a></li>
    <li><a href="/webgl/lessons/ja/webgl-animation.html">WebGL - Animation(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-and-alpha.html">WebGL and Alpha(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-2d-vs-3d-library.html">WebGL - 2D vs 3D libraries(英語)</a></li>
    <li><a href="/webgl/lessons/ja/webgl-anti-patterns.html">WebGL - Anti-Patterns(英語)</a></li>
  </ul>
</ul>
<ul>
  <li><a href="/docs/">Helper API Docs(英語)</a></li>
  <li><a href="http://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/greggman/webgl-fundamentals">github</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        <div>質問? <a href="http://stackoverflow.com/questions/tagged/webgl">stackoverflowで質問(英語)</a>.</div>
        <div>問題点/バグ? <a href="http://github.com/greggman/webgl-fundamentals/issues">githubでissueを作成</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGLのデータテクスチャ';
            var disqus_title = 'WebGLのデータテクスチャ';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js"></script>
<script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');

</script>


</html>



