<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/zh_cn/webgl-resizing-the-canvas.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Gregg Tavares. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta property="og:title" content="WebGL 重置画布尺寸" />
<meta property="og:type" content="website" />
<meta property="og:image" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />
<meta property="og:description" content="如何充值一个WebGL画布以及设计的问题" />
<meta property="og:url" content="http://webglfundamentals.org/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="webglfundamentals.org" />
<meta name="twitter:title" content="WebGL 重置画布尺寸" />
<meta name="twitter:url" content="http://webglfundamentals.org/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html" />
<meta name="twitter:description" content="如何充值一个WebGL画布以及设计的问题" />
<meta name="twitter:image:src" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />


<title>WebGL 重置画布尺寸</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css" type="text/css" />
</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-resizing-the-canvas.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-resizing-the-canvas.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-resizing-the-canvas.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-resizing-the-canvas.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-resizing-the-canvas.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-resizing-the-canvas.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-resizing-the-canvas.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html" selected>简体中文</a>
</select>


    <a href="#toc">目录</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/zh_cn/">WebGLFundamentals.org</a></h1>
</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL 重置画布尺寸</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>这是重置画布尺寸时应该知道的知识。</p>
<p>每个画布都有两个尺寸，一个是 drawingbuffer 的尺寸，
这个表示画布中有多少个像素。另一是画布显示的尺寸，
CSS决定画布显示的尺寸。</p>
<p>你可以通过两种方式设置画布的 drawingbuffer尺寸。一种是使用HTML</p>
<pre><code>&lt;canvas id=&quot;c&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;
</code></pre><p>另一种是使用JavaScript</p>
<pre><code>&lt;canvas id=&quot;c&quot; &gt;&lt;/canvas&gt;
</code></pre><p>JavaScript</p>
<pre><code>var canvas = document.getElementById(&quot;c&quot;);
canvas.width = 400;
canvas.height = 300;
</code></pre><p>如果你没有使用CSS影响到画布的显示尺寸，画布的显示尺寸则和 drawingbuffer 尺寸相同。
所以在上述两个例子中画布的 drawingbuffer 尺寸和显示尺寸都是 400x300。</p>
<p>在下方的例子中画布的显示尺寸是 400x300，drawingbuffer 是 10x15</p>
<pre><code>&lt;canvas id=&quot;c&quot; width=&quot;10&quot; height=&quot;15&quot; style=&quot;width: 400px; height: 300px;&quot;&gt;&lt;/canvas&gt;
</code></pre><p>或者像这样</p>
<pre><code>&lt;style&gt;
#c {
  width: 400px;
  height: 300px;
}
&lt;/style&gt;
&lt;canvas id=&quot;c&quot; width=&quot;10&quot; height=&quot;15&quot;&gt;&lt;/canvas&gt;
</code></pre><p>如果我们在画布上绘制以一个单像素宽度的线，就会得到这样的结果</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-10x15-canvas-400x300-css.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-10x15-canvas-400x300-css.html" target="_blank">点此在新窗口中浏览</a>
</div>

</p>
<p>为什么它被模糊了？因为浏览器得到 10x15 像素的画布，将它拉伸到 400x300 像素，
然后在拉伸的过程中进行了插值。</p>
<p>假设我们想让画布填充满窗口该怎么做？首先使用CSS让浏览器将画布铺满窗口，例如</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;style&gt;
      /* 移除边界 */
      body {
        border: 0;
        background-color: white;
      }
      /* 设置欢度大小为视域大小 */
      canvas {
        width: 100vw;
        height: 100vh;
        display: block;
      }
    &lt;style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;canvas id=&quot;c&quot;&gt;&lt;/canvas&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>现在只需要将 drawingbuffer 的尺寸设置为为浏览器拉伸后的画布尺寸。
我们可以使用 <code>clientWidth</code> 和 <code>clientHeight</code> 属性，这个属性是所有HTML元素都有的属性，
可以让JavaScript获取元素显示的尺寸。</p>
<pre><code>function resize(canvas) {
  // 获取浏览器中画布的显示尺寸
  var displayWidth  = canvas.clientWidth;
  var displayHeight = canvas.clientHeight;

  // 检尺寸是否相同
  if (canvas.width  != displayWidth ||
      canvas.height != displayHeight) {

    // 设置为相同的尺寸
    canvas.width  = displayWidth;
    canvas.height = displayHeight;
  }
}
</code></pre><p>大多数WebGL应用是<a href="webgl-animation.html">变化</a>的，所以我们需要在绘制之前调用这个方法调画布为期望的大小。</p>
<pre><code>function drawScene() {
   resize(gl.canvas);

   ...
</code></pre><p>这是结果</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-resize-canvas.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-resize-canvas.html" target="_blank">点此在新窗口中浏览</a>
</div>

</p>
<p>哪里出问题了？为什么这个线没有覆盖整个区域？</p>
<p>原因是当我们重置画布尺寸的时候还需要调用<code>gl.viewport</code>设置视域，
<code>gl.viewport</code>告诉WebGL如何将裁剪空间（-1 到 +1）中的点转换到像素空间，
也就是画布内。当你第一次创建WebGL上下文的时候WebGL会设置视域大小和画布大小匹配，
但是在那之后就需要你自己设置。当你改变画布大小就需要告诉WebGL新的视域设置。</p>
<p>让我们来修改代码处理这个问题。由于WebGL上下文引用了画布，所以直接传递它的尺寸。</p>
<pre><code>function drawScene() {
   resize(gl.canvas);

+   gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
   ...
</code></pre><p>现在没问题了。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-resize-canvas-viewport.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-resize-canvas-viewport.html" target="_blank">点此在新窗口中浏览</a>
</div>

</p>
<p>在新窗口中打开，改变窗口大小，发现它总是填满窗口。</p>
<p>我知道你会问，为什么WebGL不在画布尺寸改变的时候自动帮我们修改视域？
原因是它不知道你如何以及为什么使用视域，
你可以渲染到一个帧缓冲或者做其他的事情需要不同的视域尺寸。
WebGL没办法知道你的意图所以就不能自动帮你设置视域。</p>
<p>如果你看了很多WebGL应用他们处理或者设置画布尺寸有很多不同的方式，
如果你好奇的话<a href="webgl-anti-patterns.html">这里有一些我认为比较合适的方式</a>。</p>
<div class="webgl_bottombar">
<h3>对于 Retina 或 HD-DPI 该怎么办？</h3>
<p>
当你使用CSS像素值声明画布的尺寸时，这个叫做CSS像素值，可能不是真实像素值。
大多数现代智能手机有叫做高清显示(HD-DPI)或者苹果叫它“Retina Display”的特性。
对于文字和大多数CSS样式浏览器会自动绘制HD-DPI图形，但是对于WebGL，
由于你来控制绘制图形，所以取决于你想绘制一般分辨率还是“HD-DPI”品质。
</p>
<p>为了实现这个我们需要获得<code>window.devicePixelRatio</code>的值，
这个值告诉我们1个CSS像素对应多少个实际像素。
我们可以修改 resize 方法处理这种情况。</p>
<pre class="prettyprint">
function resize(gl) {
  var realToCSSPixels = window.devicePixelRatio;

  // 获取浏览器显示的画布的CSS像素值
  // 然后计算出设备像素设置drawingbuffer
  var displayWidth  = Math.floor(gl.canvas.clientWidth  * realToCSSPixels);
  var displayHeight = Math.floor(gl.canvas.clientHeight * realToCSSPixels);

  // 检查画布尺寸是否相同
  if (gl.canvas.width  !== displayWidth ||
      gl.canvas.height !== displayHeight) {

    // 设置为相同的尺寸
    gl.canvas.width  = displayWidth;
    gl.canvas.height = displayHeight;
  }
}
</pre>
<p>如果你有一个HD-DPI显示器，例如在智能手机上浏览这个网页的话，
你就会发现下面的线要比之前的线，也就是没有对HD-DPI做调整的线要细一些。</p>
<div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-resize-canvas-hd-dpi.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-resize-canvas-hd-dpi.html" target="_blank">点此在新窗口中浏览</a>
</div>


<p>是否需要根据HD-DPI做调整取决于你自己。
在 iPhone4 或 iPhone5 上 <code>window.devicePixelRatio</code> 的值是 <code>2</code>,
意味着你要绘制 4 倍的像素个数。我确定在 iPhone6Plus 上那个值是 <code>3</code>，
意味着 9 倍的像素个数。这样就会拖慢你的应用，
实际上在游戏中常用的优化是绘制比显示数量要小的像素个数，
让GPU缩放它们。这其实取决于你的目的，如果你想绘制用于打印的图形，
你可能希望支持 HD-DPI，如果你想做一个游戏想给用户多种选择，
让他们根据自己的机器调整配置，控制显示分辨率。</p>
</div>



    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-resizing-the-canvas.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-resizing-the-canvas.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-resizing-the-canvas.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-resizing-the-canvas.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-resizing-the-canvas.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-resizing-the-canvas.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-resizing-the-canvas.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html" selected>简体中文</a>
</select>


        <div id="toc">
          <ul>
  <li>基础概念</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-fundamentals.html">WebGL 基础概念</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-how-it-works.html">WebGL 工作原理</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-shaders-and-glsl.html">WebGL 着色器和GLSL</a></li>
  </ul>
  <li>图像处理</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-image-processing.html">WebGL 图像处理</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-image-processing-continued.html">WebGL 进一步处理图像</a></li>
  </ul>
  <li>二维平移，旋转，缩放和矩阵运算</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-2d-translation.html">WebGL 二维平移</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-2d-rotation.html">WebGL 二维旋转</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-2d-scale.html">WebGL 二维缩放</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-2d-matrices.html">WebGL 二维矩阵</a></li>
  </ul>
  <li>三维</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-orthographic.html">WebGL 三维正射投影</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective.html">WebGL 三维透视投影</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-camera.html">WebGL 三维相机</a></li>
  </ul>
  <li>光照</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-directional.html">WebGL 三维方向光源</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-point.html">WebGL 三维点光源</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html">WebGL 三维聚光灯</a></li>
  </ul>
  <li>组织和重构</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-less-code-more-fun.html">WebGL 码少趣多</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-drawing-multiple-things.html">WebGL 绘制多个物体</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-scene-graph.html">WebGL 场景图</a></li>
  </ul>
  <li>几何</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-geometry-lathe.html">WebGL 三维几何加工</a></li>
  </ul>
  <li>纹理</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-textures.html">WebGL 三维纹理</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-data-textures.html">WebGL 数据纹理</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-2-textures.html">WebGL 使用多个纹理</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-cors-permission.html">WebGL 跨域图像</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html">WebGL 纹理映射的透视纠正</a></li>
  </ul>
  <li>渲染到纹理</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-render-to-texture.html">WebGL 渲染到纹理</a></li>
  </ul>
  <li>技术</li>
  <ul>
    <li>二维</li>
    <ul>
      <li><a href="/webgl/lessons/zh_cn/webgl-2d-drawimage.html">WebGL 二维DrawImage</a>
      <li><a href="/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html">WebGL 二维矩阵栈</a>
    </ul>
    <li>三维</li>
    <ul>
      <li><a href="/webgl/lessons/zh_cn/webgl-cube-maps.html">WebGL 立方体贴图</a></li>
      <li><a href="/webgl/lessons/zh_cn/webgl-environment-maps.html">WebGL 环境贴图</a></li>
      <li><a href="/webgl/lessons/zh_cn/webgl-skybox.html">WebGL 天空盒</a></li>
      <li><a href="/webgl/lessons/zh_cn/webgl-skinning.html">WebGL 蒙皮</a></li>
    </ul>
    <li>文字</li>
    <ul>
      <li><a href="/webgl/lessons/zh_cn/webgl-text-html.html">WebGL 文字 - HTML</a>
      <li><a href="/webgl/lessons/zh_cn/webgl-text-canvas2d.html">WebGL 文字 - 二维Canvas</a>
      <li><a href="/webgl/lessons/zh_cn/webgl-text-texture.html">WebGL 文字 - 使用纹理</a>
      <li><a href="/webgl/lessons/zh_cn/webgl-text-glyphs.html">WebGL 文字 - 使用字形纹理</a>
    </ul>
  </ul>
  <li>杂项</li>
  <ul>
    <li><a href="/webgl/lessons/zh_cn/webgl-setup-and-installation.html">WebGL 设置和安装</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-boilerplate.html">WebGL 样板</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html">WebGL 重置画布尺寸</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-animation.html">WebGL 动画</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-and-alpha.html">WebGL 和阿尔法通道</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-2d-vs-3d-library.html">WebGL 2D vs 3D 库</a></li>
    <li><a href="/webgl/lessons/zh_cn/webgl-anti-patterns.html">WebGL 错误模式</a></li>
  </ul>
</ul>
<ul>
  <li><a href="/docs/">API 帮助文档</a></li>
  <li><a href="http://twgljs.org">TWGL, 一个轻量级WebGL辅助库</a></li>
  <li><a href="https://github.com/greggman/webgl-fundamentals">GitHub</a></li>
</ul>

        </div>
    </div>
    <div class="lesson-comments">
        <div>有关于WebGL的疑问? <a href="http://stackoverflow.com/questions/tagged/webgl">在Stackoverflow提问</a>。</div>
        <div>有意见或建议? <a href="http://github.com/vinci-mz/webgl-fundamentals/issues">在GitHub上提issue</a>。</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL 重置画布尺寸';
            var disqus_title = 'WebGL 重置画布尺寸';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js"></script>
<script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');

</script>


</html>



